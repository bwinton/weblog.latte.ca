<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hey!  Let‚Äôs Write a WebExtension! | Blog-O!</title>
<link href="../../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://bwinton.github.io/weblog.latte.ca/blake/tech/firefox/webextensiontutorial.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Blake Winton">
<link rel="prev" href="../../employment/mozilla/sixyears.html" title="A long time ago, on a computer far far away‚Ä¶" type="text/html">
<link rel="next" href="../../../amy/everythingelse/lettertomum.html" title="A Letter to My Mother on what would have been her 81st Birthday" type="text/html">
<meta property="og:site_name" content="Blog-O!">
<meta property="og:title" content="Hey!  Let‚Äôs Write a WebExtension!">
<meta property="og:url" content="https://bwinton.github.io/weblog.latte.ca/blake/tech/firefox/webextensiontutorial.html">
<meta property="og:description" content="(This article is also posted on Mozilla
Hacks.)
You might have heard about Mozilla‚Äôs WebExtensions, our
implementation of a new browser extension API for writing
multiprocess-compatible add-ons.  Mayb">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-09-21T14:52:00-04:00">
<meta property="article:tag" content="addon">
<meta property="article:tag" content="firefox">
<meta property="article:tag" content="mozilla">
<meta property="article:tag" content="webextension">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://bwinton.github.io/weblog.latte.ca/">

                <span id="blog-title">Blog-O!</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../archive.html">Archive</a>
                </li>
<li>
<a href="../../../tags/index.html">Tags</a>
                </li>
<li>
<a href="../../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Custom search --><form method="get" id="search" action="//duckduckgo.com/" class="navbar-form pull-right">
<input type="hidden" name="sites" value="https://bwinton.github.io/weblog.latte.ca/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search‚Ä¶" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Hey!  Let‚Äôs Write a WebExtension!</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Blake Winton</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-09-21T14:52:00-04:00" itemprop="datePublished" title="2015-09-21 14:52">2015-09-21 14:52</time></a></p>
                <p class="commentline">
        
    <a href="webextensiontutorial.html#disqus_thread" data-disqus-identifier="/blake/tech/firefox/webextensiontutorial">Comments</a>


            

        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p><small>(This article is also posted on <a href="https://hacks.mozilla.org/2015/09/lets_write_a_webextension/">Mozilla
Hacks</a>.)</small></p>
<p>You might have heard about Mozilla‚Äôs <a href="https://wiki.mozilla.org/WebExtensions" title="Mozilla‚Äôs WebExtensions Wiki Page">WebExtensions</a>, our
implementation of a new browser extension API for writing
multiprocess-compatible add-ons.  Maybe you‚Äôve been wondering what it was about,
and how you could use it. Well, I‚Äôm here to help!  I think <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions" title="MDN‚Äôs WebExtensions Documentation">MDN‚Äôs WebExtensions
Docs</a> have a pretty great definition:</p>
<blockquote>
<p>WebExtensions are a new way to write Firefox extensions.</p>
<p>The technology is developed for cross-browser compatibility: to a large extent
the API is compatible with the <a href="https://developer.chrome.com/extensions" title="Chrome‚Äôs Extension API">extension API</a> supported by Google
Chrome and Opera. Extensions written for these browsers will in most cases run
in Firefox with just a few changes. The API is also fully compatible with
<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Multiprocess_Firefox" title="a.k.a. Electrolysis">multiprocess Firefox</a>.</p>
</blockquote>
<p>The only thing I would add is that while Mozilla is implementing most of the API
that Chrome and Opera support, we‚Äôre not restricting ourselves to only that API.
Where it makes sense, we will be adding new functionality and talking with other
browser makers about implementing it as well.  Finally, since the WebExtension
API is still under development, it‚Äôs probably best if you use <a href="https://nightly.mozilla.org/" title="Download Nightly Here">Firefox
Nightly</a> for this tutorial, so that you get the most up-to-date,
standards-compliant behaviour.  But keep in mind, this is still experimental
technology ‚Äî things might break!</p>
<h4>Starting off</h4>
<p>Okay, let‚Äôs start with a reasonably simple add-on. We‚Äôll add a button, and when
you click it, it will open up <a href="http://chilloutandwatchsomecatgifs.com/" title="Cat Gifs!">one of my favourite sites</a> in a new
tab.</p>
<!-- TEASER_END -->

<p>The first file we‚Äôll need is a <a href="https://developer.chrome.com/extensions/manifest" title="Chrome‚Äôs Manifest Documentation"><code>manifest.json</code></a>, to tell Firefox
about our add-on.</p>
<pre class="code literal-block"><span></span><span class="p">{</span>
  <span class="nt">"manifest_version"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Cat Gifs!"</span><span class="p">,</span>
  <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"1.0"</span><span class="p">,</span>
  <span class="nt">"applications"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"gecko"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"catgifs@mozilla.org"</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nt">"browser_action"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"default_title"</span><span class="p">:</span> <span class="s2">"Cat Gifs!"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>


<p>Great!  We‚Äôre done!  Hopefully your code looks a little <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-1" title="Step One">like this</a>.
Of course, we have no idea if it works yet, so let‚Äôs install it in Firefox
(we‚Äôre using Firefox Nightly for the latest implementation). You could try to
drag the <code>manifest.json</code>, or the whole directory, onto Firefox, but that really
won‚Äôt give you what you want.</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/1-DirectoryListing.png"><img alt="The directory listing." src="../../../images/blake/WebExtensions/HowTo/1-DirectoryListing.png"></a></p>
<h4>Installing</h4>
<p>To make Firefox recognize your extension as an add-on, you need to give it a zip
file which ends in <code>.xpi</code>, so let‚Äôs make one of those by first installing
<a href="http://www.7-zip.org/" title="7-Zip‚Äôs website">7-Zip</a>, and then typing <code>7z a catgifs.xpi manifest.json</code>. (If you‚Äôre
on Mac or Linux, the <code>zip</code> command should be built-in, so just type <code>zip
catgifs.xpi manifest.json</code>.) Then you can drag the <code>catgifs.xpi</code> onto Firefox,
and it will show you an error because our extension is unsigned.</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/2-FirstError.png"><img alt="The first error." src="../../../images/blake/WebExtensions/HowTo/2-FirstError.png"></a></p>
<p>We can work around this by going to <code>about:config</code>, typing
<code>xpinstall.signatures.required</code> in the search box, double-clicking the entry to
set it to false, and then closing that tab.  After that, when we drop
<code>catgifs.xpi</code> onto Firefox, we get the option to install our new add-on!</p>
<blockquote>
<p>It‚Äôs important to note that as of Firefox 44 (later this year), add-ons will
<a href="https://wiki.mozilla.org/Addons/Extension_Signing" title="Extension Signing Documentation">require a signature</a> to be installed on Firefox Beta or Release
versions of the brower, so even if you set the preference described above, you
will soon still need to be running Firefox Nightly or Developer Edition to
follow this tutorial.</p>
</blockquote>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/3-SuccessDialog.png"><img alt="Success!!!" src="../../../images/blake/WebExtensions/HowTo/3-SuccessDialog.png"></a></p>
<p>Of course, our add-on doesn‚Äôt do a whole lot yet.</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/4-ButtonClick.png"><img alt="I click and click, but nothing happens." src="../../../images/blake/WebExtensions/HowTo/4-ButtonClick.png"></a></p>
<p>So let‚Äôs fix that!</p>
<h4>Adding features</h4>
<p>First, we‚Äôll add the following lines to <code>manifest.json</code>, above the line
containing <a href="https://developer.chrome.com/extensions/browserAction" title="Chrome‚Äôs Browser Action Documentation"><code>browser_action</code></a>:</p>
<pre class="code literal-block"><span></span>  <span class="s2">"background"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"scripts"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"background.js"</span><span class="p">],</span>
    <span class="nt">"persistent"</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">}</span><span class="err">,</span>
</pre>


<p>now, of course, that‚Äôs pointing at a <code>background.js</code> file that doesn‚Äôt exist
yet, so we should create that, too.  Let‚Äôs paste the following javascript in it:</p>
<pre class="code literal-block"><span></span><span class="s1">'use strict'</span><span class="p">;</span>

<span class="cm">/*global chrome:false */</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">setBadgeText</span><span class="p">({</span><span class="nx">text</span><span class="o">:</span> <span class="s1">'(„ÉÑ)'</span><span class="p">});</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">setBadgeBackgroundColor</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span> <span class="s1">'#eae'</span><span class="p">});</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">aTab</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="s1">'url'</span><span class="o">:</span> <span class="s1">'http://chilloutandwatchsomecatgifs.com/'</span><span class="p">,</span> <span class="s1">'active'</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">});</span>
</pre>


<p>And you should get something that looks <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-2" title="Step Two">like this</a>.  Re-create the
add-on by typing <code>7z a catgifs.xpi manifest.json background.js</code> (or <code>zip
catgifs.xpi manifest.json background.js</code>), and drop <code>catgifs.xpi</code> onto Firefox
again, and now, when we click the button, we should get a new tab!  üòÑ</p>
<p><img alt="Cat Gifs!" src="../../../images/blake/WebExtensions/HowTo/5-CatGifs.gif"></p>
<h4>Automating the build</h4>
<p>I don‚Äôt know about you, but I ended up typing <code>7z a catgifs.xpi manifest.json</code> a
disappointing number of times, and wondering why my <code>background.js</code> file wasn‚Äôt
running.  Since I know where this blog post is ending up, I know we‚Äôre going to
be adding a bunch more files, so I think it‚Äôs time to add a build script.  I
hear that the go-to build tool these days is <a href="http://gulpjs.com/" title="Gulp‚Äôs Homepage"><code>gulp</code></a>, so I‚Äôll wait
here while you <a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md#getting-started" title="Gulp‚Äôs Installation Instructions">go install that</a>, and c‚Äômon back when you‚Äôre done.  (I
needed to install <a href="https://nodejs.org/" title="Node‚Äôs Homepage">Node</a>, and then gulp twice.  I‚Äôm not sure why.)</p>
<p>So now that we have gulp installed, we should make a file named <code>gulpfile.js</code> to
tell it how to build our add-on.</p>
<pre class="code literal-block"><span></span><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'manifest.json'</span><span class="p">,</span> <span class="s1">'background.js'</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">xpiName</span> <span class="o">=</span> <span class="s1">'catgifs.xpi'</span><span class="p">;</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'default'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="nx">xpiName</span><span class="p">)</span>
<span class="p">});</span>
</pre>


<p>Once you have that file looking something <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-3" title="Step Three">like this</a>, you can type
<code>gulp</code>, and see output that looks something like this</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/6-GulpOutput.png"><img alt="Just some command line stuff, nbd." src="../../../images/blake/WebExtensions/HowTo/6-GulpOutput.png"></a></p>
<p>Now, you may notice that we didn‚Äôt actually build the add-on.  To do that, we
will need to install another package to zip things up.  So, type <code>npm install
gulp-zip</code>, and then change the <code>gulpfile.js</code> to contain the following:</p>
<pre class="code literal-block"><span></span><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">zip</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-zip'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'manifest.json'</span><span class="p">,</span> <span class="s1">'background.js'</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">xpiName</span> <span class="o">=</span> <span class="s1">'catgifs.xpi'</span><span class="p">;</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'default'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">zip</span><span class="p">(</span><span class="nx">xpiName</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'.'</span><span class="p">));</span>
<span class="p">});</span>
</pre>


<p>Once your <code>gulpfile.js</code> looks <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-4" title="Step Four">like this</a>, when we run it, it will
create the <code>catgifs.xpi</code> (as we can tell by looking at the timestamp, or by
deleting it and seeing it get re-created).</p>
<h4>Fixing a bug</h4>
<p>Now, if you‚Äôre like me, you clicked the button a whole bunch of times, to test
it out and make sure it‚Äôs working, and you might have ended up with a lot of
tabs.  While this will ensure you remain extra-chill, it would probably be nicer
to only have one tab, either creating it, or switching to it if it exists, when
we click the button.  So let‚Äôs go ahead and add that.</p>
<p><img alt="Lots and lots of cats." src="../../../images/blake/WebExtensions/HowTo/7-ManyTabbys.gif"></p>
<p>The first thing we want to do is see if the tab exists, so let‚Äôs edit the
<code>browserAction.onClicked</code> listener in <code>background.js</code> to contain the following:</p>
<pre class="code literal-block"><span></span><span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">aTab</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="s1">'url'</span><span class="o">:</span> <span class="s1">'http://chilloutandwatchsomecatgifs.com/'</span><span class="p">},</span> <span class="p">(</span><span class="nx">tabs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// There is no catgif tab!</span>
      <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="s1">'url'</span><span class="o">:</span> <span class="s1">'http://chilloutandwatchsomecatgifs.com/'</span><span class="p">,</span> <span class="s1">'active'</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Do something here‚Ä¶</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre>


<p>Huh, that‚Äôs weird, it‚Äôs always creating a new tab, no matter how many catgifs
tabs there are already‚Ä¶  It turns out that our add-on doesn‚Äôt have permission to
see the urls for existing tabs yet which is why it can‚Äôt find them, so let‚Äôs go
ahead and add that by inserting the following code above the <code>browser_action</code>:</p>
<pre class="code literal-block"><span></span>  <span class="s2">"permissions"</span><span class="err">:</span> <span class="p">[</span>
    <span class="s2">"tabs"</span>
  <span class="p">]</span><span class="err">,</span>
</pre>


<p>and once your code looks <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-5" title="Step Five">similar to this</a>, re-run <code>gulp</code> to rebuild
the add-on, and drag-and-drop to install it, and then when we test it out,
ta-da!  Only one catgif tab!  Of course, if we‚Äôre on another tab it doesn‚Äôt do
anything, so let‚Äôs fix that.  We can change the <code>else</code> block to contain the
following:</p>
<pre class="code literal-block"><span></span>      <span class="c1">// Do something here‚Ä¶</span>
      <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="s1">'url'</span><span class="o">:</span> <span class="s1">'http://chilloutandwatchsomecatgifs.com/'</span><span class="p">,</span> <span class="s1">'active'</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="p">(</span><span class="nx">active</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">active</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">'active'</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span>
</pre>


<p>make sure it looks <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-6" title="Step Six">like this</a>, rebuild, re-install, and shazam, it
works!</p>
<h4>Making it look nice</h4>
<p>Well, it works, but it‚Äôs not really pretty.  Let‚Äôs do a couple of things to fix
that a bit.</p>
<p>First of all, we can add a custom icon so that our add-on doesn‚Äôt look like all
the other add-ons that haven‚Äôt bothered to set their icons‚Ä¶  To do that, we add
the following to <code>manifest.json</code> after the <code>manifest_version</code> line:</p>
<pre class="code literal-block"><span></span>  <span class="s2">"icons"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"48"</span><span class="p">:</span> <span class="s2">"icon.png"</span><span class="p">,</span>
    <span class="nt">"128"</span><span class="p">:</span> <span class="s2">"icon128.png"</span>
  <span class="p">}</span><span class="err">,</span>
</pre>


<p>And, of course, we‚Äôll need to download a pretty picture for our icon, so let‚Äôs
save a copy of <a href="https://raw.githubusercontent.com/bwinton/catgif-extension/master/icon.png" title="icon.png">this picture</a> as <code>icon.png</code>, and <a href="https://raw.githubusercontent.com/bwinton/catgif-extension/master/icon128.png" title="icon128.png">this one</a>
as <code>icon128.png</code>.</p>
<p>We should also have a prettier icon for the button, so going back to the
<code>manifest.json</code>, let‚Äôs add the following lines in the <code>browser_action</code> block
before the <code>default_title</code>:</p>
<pre class="code literal-block"><span></span>    <span class="s2">"default_icon"</span><span class="err">:</span> <span class="p">{</span>
      <span class="nt">"19"</span><span class="p">:</span> <span class="s2">"button.png"</span><span class="p">,</span>
      <span class="nt">"38"</span><span class="p">:</span> <span class="s2">"button38.png"</span>
    <span class="p">}</span><span class="err">,</span>
</pre>


<p>and save <a href="https://raw.githubusercontent.com/bwinton/catgif-extension/master/button.png" title="button.png">this image</a> as <code>button.png</code>, and <a href="https://raw.githubusercontent.com/bwinton/catgif-extension/master/button38.png" title="button38.png">this image</a> as
<code>button38.png</code>.</p>
<p>Finally, we need to tell our build script about the new files, so change the
<code>files</code> line of our <code>gulpfile.js</code> to:</p>
<pre class="code literal-block"><span></span><span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'manifest.json'</span><span class="p">,</span> <span class="s1">'background.js'</span><span class="p">,</span> <span class="s1">'*.png'</span><span class="p">];</span>
</pre>


<p>Re-run the build, and re-install the add-on, and <a href="https://github.com/bwinton/catgif-extension/releases/tag/step-7" title="Step Seven">we‚Äôre done</a>!  üòÄ</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/8-PrettyIcon.png"><img alt="New, prettier, icons." src="../../../images/blake/WebExtensions/HowTo/8-PrettyIcon.png"></a></p>
<h4>One more thing‚Ä¶</h4>
<p>Well, there is another thing we could try to do.  I mean, we have an add-on that
works beautifully in Firefox, but one of the advantages of the new WebExtension
API is that you can run the same add-on (or an add-on with minimal changes) on
both Firefox and Chrome.  So let‚Äôs see what it will take to get this running in
both browsers!</p>
<p>We‚Äôll start by launching Chrome, and trying to load the add-on, and see what
errors it gives us.  To load our extension, we‚Äôll need to go to
<code>chrome://extensions/</code>, and check the <code>Developer mode</code> checkbox, as shown below:</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/9-ChromeDeveloper.png"><img alt="Now we‚Äôre hackers!" src="../../../images/blake/WebExtensions/HowTo/9-ChromeDeveloper.png"></a></p>
<p>Then we can click the ‚ÄúLoad unpacked extension‚Ä¶‚Äù button, and choose our
directory to load our add-on!  Uh-oh, it looks like we‚Äôve got an error.</p>
<p><a href="../../../images/blake/WebExtensions/HowTo/large/10-ChromeAlmost.png"><img alt="Close, but not quite." src="../../../images/blake/WebExtensions/HowTo/10-ChromeAlmost.png"></a></p>
<p>Since the <code>applications</code> key is required for Firefox, I think we can safely
ignore this error.  And anyways, the button shows up!  And when we click it‚Ä¶</p>
<p><img alt="Cats!" src="../../../images/blake/WebExtensions/HowTo/11-ChromeCats.gif"></p>
<p>So, I guess we‚Äôre done!  (I used to have a section in here about how to load
<a href="https://babeljs.io/" title="Babel!">babel.js</a>, because the version of Chrome I was using didn‚Äôt support
ES6‚Äôs <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" title="a.k.a. Fat-Arrows.">arrow functions</a>, but apparently they upgraded their JavaScript
engine, and now everything is good.  üòâ)</p>
<p>Finally, if you have any questions, or run into any problems following this
tutorial, please feel free to leave a comment below, or get in touch with me
through <a href="mailto:bwinton@latte.ca" title="My email address">email</a> or on <a href="https://twitter.com/bwinton/" title="@bwinton">twitter</a>!  If you have issues or
constructive feedback developing WebExtensions, the team will be listening on
the <a href="https://discourse.mozilla-community.org/c/add-ons/development" title="Discourse: for all your communication needs.">Discourse forum</a>.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../tags/addon.html" rel="tag">addon</a></li>
            <li><a class="tag p-category" href="../../../tags/firefox.html" rel="tag">firefox</a></li>
            <li><a class="tag p-category" href="../../../tags/mozilla.html" rel="tag">mozilla</a></li>
            <li><a class="tag p-category" href="../../../tags/webextension.html" rel="tag">webextension</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../employment/mozilla/sixyears.html" rel="prev" title="A long time ago, on a computer far far away‚Ä¶">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../amy/everythingelse/lettertomum.html" rel="next" title="A Letter to My Mother on what would have been her 81st Birthday">Next post</a>
            </li>
        </ul></nav></aside><section class="comments"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="latteblog",
            disqus_url="https://bwinton.github.io/weblog.latte.ca/blake/tech/firefox/webextensiontutorial.html",
        disqus_title="Hey!  Let\u2019s Write a WebExtension!",
        disqus_identifier="/blake/tech/firefox/webextensiontutorial",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="latteblog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer"><div style="margin-bottom: 12px">Contents ¬© 2016         <a href="mailto:bwinton@latte.ca">Blake Winton</a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
<img alt="Creative Commons License BY-NC-SA" style="border-width: 0; vertical-align: bottom" src="https://licensebuttons.net/l/by-nc-sa/2.5/88x31.png"></a>
</div>
            
        </footer>
</div>
</div>


            <script src="../../../assets/js/jquery.min.js"></script><script src="../../../assets/js/bootstrap.min.js"></script><script src="../../../assets/js/moment-with-locales.min.js"></script><script src="../../../assets/js/fancydates.js"></script><script src="../../../assets/js/jquery.colorbox-min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5805429-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
