<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Snakes on an Apple! | Blog-O!</title>
<link href="../../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://bwinton.github.io/weblog.latte.ca/blake/tech/mac/badpun.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Blake Winton">
<link rel="prev" href="../../../delphine/conversations/why.html" title="Why?" type="text/html">
<link rel="next" href="../../../amy/books/_2006/aug25.html" title="Books in August" type="text/html">
<meta property="og:site_name" content="Blog-O!">
<meta property="og:title" content="Snakes on an Apple!">
<meta property="og:url" content="https://bwinton.github.io/weblog.latte.ca/blake/tech/mac/badpun.html">
<meta property="og:description" content="As I mentioned
before, we got a Mac Mini.  It's been a bit of a pain getting it all
set up, but I think we're finally done.  The web server is moved over,
along with all the websites.  The mail server">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2006-08-24T22:23:00-04:00">
<meta property="article:tag" content="mac">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://bwinton.github.io/weblog.latte.ca/">

                <span id="blog-title">Blog-O!</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../archive.html">Archive</a>
                </li>
<li>
<a href="../../../tags/index.html">Tags</a>
                </li>
<li>
<a href="../../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Custom search --><form method="get" id="search" action="//duckduckgo.com/" class="navbar-form pull-right">
<input type="hidden" name="sites" value="https://bwinton.github.io/weblog.latte.ca/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Snakes on an Apple!</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Blake Winton</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2006-08-24T22:23:00-04:00" itemprop="datePublished" title="2006-08-24 22:23">2006-08-24 22:23</time></a></p>
                <p class="commentline">
        
    <a href="badpun.html#disqus_thread" data-disqus-identifier="/blake/tech/mac/badpun">Comments</a>


            

        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>As I <a href="http://weblog.latte.ca/firstpost.html">mentioned
before</a>, we got a Mac Mini.  It's been a bit of a pain getting it all
set up, but I think we're finally done.  The web server is moved over,
along with all the websites.  The mail server is moved over, and I took
the opportunity to delete my mother's account.  (That's not as bad as it
sounds.  She had it redirecting to GMail anyways, and the error message
says as much.  Of course, since I haven't told her about it yet, this
will probably come as a bit of a surprise.)  Uh, and that turned out to
be all the servers I was running.  Well, I was running CherryPy, and
some other stuff, but it wasn't particularly important, and I've found
better ways of doing it, for the most part.</p>
<p>But that's not really why I'm posting here.  I'm posting here because
I got some cool Python stuff working under the Mac, and I wanted to
share it.  Specifically, I (or rather, my wife and I) wanted to have a
window showing on the login screen, displaying <a href="http://weatheroffice.ec.gc.ca/city/pages/on-143_metric_e.html">the
weather</a>.  After several bits of trial and error, and liberal
"borrowing" from <a href="http://livingcode.org/">Dethe Elza</a>'s <a href="http://livingcode.org/project/pastels/">Pastels project</a> I
finally got something which would do what I wanted.  First, the code:</p>
<table class="codehilitetable"><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td>
<td class="code">
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">AppKit</span> <span class="kn">import</span> <span class="n">NSObject</span><span class="p">,</span> <span class="n">NSApplication</span><span class="p">,</span> <span class="n">NSTimer</span><span class="p">,</span> <span class="n">NSApp</span><span class="p">,</span> <span class="n">NSURL</span>
<span class="kn">from</span> <span class="nn">AppKit</span> <span class="kn">import</span> <span class="n">NSURLRequest</span><span class="p">,</span> <span class="n">NSWindow</span><span class="p">,</span> <span class="n">NSTitledWindowMask</span>
<span class="kn">from</span> <span class="nn">AppKit</span> <span class="kn">import</span> <span class="n">NSClosableWindowMask</span><span class="p">,</span> <span class="n">NSMiniaturizableWindowMask</span>
<span class="kn">from</span> <span class="nn">AppKit</span> <span class="kn">import</span> <span class="n">NSResizableWindowMask</span><span class="p">,</span> <span class="n">NSBackingStoreBuffered</span>
<span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">PyObjCTools</span> <span class="kn">import</span> <span class="n">AppHelper</span>
<span class="kn">from</span> <span class="nn">WebKit</span> <span class="kn">import</span> <span class="n">WebView</span><span class="p">,</span> <span class="n">WebDataSource</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">620</span><span class="p">,</span> <span class="mi">540</span>

<span class="k">def</span> <span class="nf">Window</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">NSWindow</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">initWithContentRect_styleMask_backing_defer_</span><span class="p">(</span>
        <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">)),</span>
        <span class="n">NSTitledWindowMask</span> <span class="o">|</span>
        <span class="n">NSClosableWindowMask</span> <span class="o">|</span> 
        <span class="n">NSMiniaturizableWindowMask</span> <span class="o">|</span>
        <span class="n">NSResizableWindowMask</span><span class="p">,</span>
        <span class="n">NSBackingStoreBuffered</span><span class="p">,</span>
        <span class="bp">False</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setTitle_</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">view</span><span class="p">:</span>
        <span class="n">window</span><span class="o">.</span><span class="n">setContentView_</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">orderFront_</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">window</span>

<span class="k">class</span> <span class="nc">MyAppDelegate</span><span class="p">(</span><span class="n">NSObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">timer</span> <span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wUrl</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">loadHTMLString_baseURL_</span><span class="p">(</span>
            <span class="sd">"""&lt;html&gt;&lt;head&gt;&lt;title&gt;test&lt;title&gt;%s&lt;head&gt;</span>
<span class="sd">            &lt;body&gt;%s&lt;body&gt;&lt;html&gt;"""</span> <span class="o">%</span>
            <span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span> <span class="s1">'style'</span> <span class="p">)]),</span> <span class="n">b</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">div</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wUrl</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">applicationDidFinishLaunching_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">WebView</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">initWithFrame_</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="s1">'Pastels Test'</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_delegate</span> <span class="o">=</span> <span class="n">MyWindowDelegate</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">setDelegate_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_delegate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wUrl</span> <span class="o">=</span> <span class="n">NSURL</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">initWithString_</span><span class="p">(</span>
            <span class="s2">"http://weatheroffice.ec.gc.ca/city/pages/on-143_metric_e.html"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">NSTimer</span><span class="o">.</span><span class="n">scheduledTimerWithTimeInterval_target_selector_userInfo_repeats_</span><span class="p">(</span>
            <span class="mi">1800</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">'update'</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>

<span class="k">class</span> <span class="nc">MyWindowDelegate</span><span class="p">(</span><span class="n">NSObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">windowWillClose_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="n">NSApp</span><span class="p">()</span><span class="o">.</span><span class="n">terminate_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app_delegate</span> <span class="o">=</span> <span class="n">MyAppDelegate</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
    <span class="n">NSApplication</span><span class="o">.</span><span class="n">sharedApplication</span><span class="p">()</span><span class="o">.</span><span class="n">setDelegate_</span><span class="p">(</span><span class="n">app_delegate</span><span class="p">)</span>   
    <span class="n">AppHelper</span><span class="o">.</span><span class="n">runEventLoop</span><span class="p">(</span><span class="n">installInterrupt</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span> <span class="s2">"/dev/console"</span> <span class="p">)[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_UID</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># If the console is owned by root, start the app.</span>
            <span class="n">main</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise, sleep until it is.</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="mi">10</span> <span class="p">)</span>
</pre>
</td>
</tr></table>
<p><br>
And next, the launchd plist file that keeps it running:</p>
<table class="codehilitetable"><tr>
<td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td>
<td class="code">
<pre class="code literal-block"><span></span><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"</span>
<span class="cp">"http://www.apple.</span>
<span class="cp">com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>  
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>ca.latte.update.login.weather<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span> 
        <span class="nt">&lt;string&gt;</span>/path/to/test.py<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>ServiceDescription<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>A program to pop up the weather in a box<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>LowPriorityIO<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>OnDemand<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;false/&gt;</span>
    <span class="nt">&lt;key&gt;</span>Nice<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/path/to/loginWeather.out<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/path/to/loginWeather.err<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre>
</td>
</tr></table>
<p>And there you have it.  Way cooler than my previous attempt, which tried
to write using <tt>sudo defaults write
/Library/Preferences/com.apple.loginwindow LoginwindowText -string
"parsed weather info here"</tt>.</p>
<p>If any of you have any questions, I'ld love to answer them as best I
can. Just comment, and I'll see what I can dig up.  By which I mean
email Dethe, and ask him.  ;)</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../tags/mac.html" rel="tag">mac</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../../delphine/conversations/why.html" rel="prev" title="Why?">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../amy/books/_2006/aug25.html" rel="next" title="Books in August">Next post</a>
            </li>
        </ul></nav></aside><section class="comments"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="latteblog",
            disqus_url="https://bwinton.github.io/weblog.latte.ca/blake/tech/mac/badpun.html",
        disqus_title="Snakes on an Apple!",
        disqus_identifier="/blake/tech/mac/badpun",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="latteblog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer"><div style="margin-bottom: 12px">Contents © 2017         <a href="mailto:bwinton@latte.ca">Blake Winton</a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
<img alt="Creative Commons License BY-NC-SA" style="border-width: 0; vertical-align: bottom" src="https://licensebuttons.net/l/by-nc-sa/2.5/88x31.png"></a>
</div>
            
        </footer>
</div>
</div>


            <script src="../../../assets/js/jquery.min.js"></script><script src="../../../assets/js/bootstrap.min.js"></script><script src="../../../assets/js/moment-with-locales.min.js"></script><script src="../../../assets/js/fancydates.js"></script><script src="../../../assets/js/jquery.colorbox-min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5805429-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
