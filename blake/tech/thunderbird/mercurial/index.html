<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How I use Mercurial (and the MQ extension). | Blog-O!</title>
<link href="../../../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/bootblog.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://bwinton.github.io/weblog.latte.ca/blake/tech/thunderbird/mercurial/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Blake Winton">
<link rel="prev" href="../../../../amy/girls/gradpassfrus/" title="Graduation, Passion, and Shopping Frustration" type="text/html">
<link rel="next" href="../../../../amy/diversions/oakvilleride/" title="Oakville ride" type="text/html">
<meta property="og:site_name" content="Blog-O!">
<meta property="og:title" content="How I use Mercurial (and the MQ extension).">
<meta property="og:url" content="https://bwinton.github.io/weblog.latte.ca/blake/tech/thunderbird/mercurial/">
<meta property="og:description" content="I started working for Mozilla Messaging a
while ago, and since David Wolever asked
me how I used Mercurial and the
MQ extension, I thought I would put up some notes on how I’m currently using
them in ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2009-06-30T22:31:48-04:00">
<meta property="article:tag" content="hg">
<meta property="article:tag" content="mercurial">
<meta property="article:tag" content="mozilla">
<meta property="article:tag" content="mq">
<meta property="article:tag" content="work">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
<!-- Custom search -->
<form method="get" id="search" action="//duckduckgo.com/" class="navbar-form pull-right">
<input type="hidden" name="sites" value="https://bwinton.github.io/weblog.latte.ca/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->

            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="https://bwinton.github.io/weblog.latte.ca/">

            <span id="blog-title">Blog-O!</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../tags/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How I use Mercurial (and the MQ extension).</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/blake-winton/">Blake Winton</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2009-06-30T22:31:48-04:00" itemprop="datePublished" title="2009-06-30 22:31">2009-06-30 22:31</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I started working for <a href="http://www.mozillamessaging.com">Mozilla Messaging</a> a
while ago, and since <a href="http://blog.codekills.net/">David Wolever</a> <a href="http://twitter.com/wolever/status/2394705659">asked
me</a> how I used Mercurial and the
MQ extension, I thought I would put up some notes on how I’m currently using
them in my day-to-day work.  Of course, the stuff I’m doing now is a little
different than what I’ve done in any of my previous jobs, so I’m not sure how
useful any of the following will be to anyone who isn’t contributing to an open
source project.</p>
<p>First, let’s talk a little bit about how I have my Work directory set up.  The
first thing I did when I started working on the Thunderbird source code was to
pull down a clean copy of the source into a directory named “src-base”.  The
purpose of that directory is to always contain a clean copy of the upstream
source code so that when I want to update the various branches I have (five, at
last count), I only need to download the changes from the Mozilla repo once,
and I can then propagate them from src-base to the other branches.  I got the
idea to do that from the Bazaar-NG developers, and I think it has helped to
keep my bandwidth usage down.  It might cause a problem if I was sharing my
branches, but since Thunderbird seems to revolve around submitting patches to
bugzilla, it works out pretty well.</p>
<p>The next thing I did was to clone src-base into a directory named
“add-reply-list-button” (because I was writing a patch to add a Reply-To-List
button :), go into that directory, and type <tt>hg qinit -c</tt> to create an
mq repository, and put the mq repository itself under version control.  (I
didn’t actually do that the first time, and was quite annoyed that I couldn’t
revert changes I had made in my patch queue.)  The other part of that is that
I’ve aliased <tt>mq</tt> to <tt>hg -R $(hg root)/.hg/patches</tt>.  This lets
me type <tt>mq commit</tt> to commit the changes to the patch.</p>
<p>So, now we’re at my day-to-day work.  If I’m working on a bug that I’ve already
got a patch started for, I cd to the appropriate branch, type <tt>hg
qseries</tt> to see where I am, and <tt>hq qpush</tt> or <tt>hg qpop</tt> to
get to the patch I want to work on.  Then I make my changes, and when I’m happy
with the results of <tt>hg diff</tt>, I type <tt>hg qrefresh</tt> to put the
changes into the patch.  After that, I use <tt>hg qdiff &gt;
../branch-name-bugnum-description.diff</tt> to get a patch that I can upload to
bugzilla.  At this point, I usually load the patch into Vim, and search for
some of the mistakes I’ve made in the past.  (<tt>/^+.*[[:space:]]+$</tt>, and
<tt>/dump</tt> caught a lot of my initial mistakes.  Now I’ve moved on to
things that are tougher to check for, like putting open-parens on a new line
instead of on the previous line.)  I usually go through a couple of cycles of
<tt>hg qrefresh</tt>/<tt>hg qdiff …</tt> before I’m happy with the patch.  Once
I am, I type <tt>mq commit -m "Updated patch to fix foo and bar."</tt> to save
the state of the patch, and then I upload it.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../tags/hg/" rel="tag">hg</a></li>
            <li><a class="tag p-category" href="../../../../tags/mercurial/" rel="tag">mercurial</a></li>
            <li><a class="tag p-category" href="../../../../tags/mozilla/" rel="tag">mozilla</a></li>
            <li><a class="tag p-category" href="../../../../tags/mq/" rel="tag">mq</a></li>
            <li><a class="tag p-category" href="../../../../tags/work/" rel="tag">work</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../../../amy/girls/gradpassfrus/" rel="prev" title="Graduation, Passion, and Shopping Frustration">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../../amy/diversions/oakvilleride/" rel="next" title="Oakville ride">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer"><div style="margin-bottom: 12px">Contents © 2020         <a href="mailto:bwinton@latte.ca">Blake Winton</a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
<img alt="Creative Commons License BY-NC-SA" style="border-width: 0; vertical-align: bottom" src="https://licensebuttons.net/l/by-nc-sa/2.5/88x31.png"></a>
</div>
            
            
        </footer>
</div>
</div>


            <script src="../../../../assets/js/jquery.min.js"></script><script src="../../../../assets/js/popper.min.js"></script><script src="../../../../assets/js/bootstrap.min.js"></script><script src="../../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5805429-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
